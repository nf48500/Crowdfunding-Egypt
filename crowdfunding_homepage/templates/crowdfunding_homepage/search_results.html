<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - Crowdfunding Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #28a745;
        }
        
        .search-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 60px 0;
        }
        
        .filter-sidebar {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .filter-section {
            margin-bottom: 2rem;
        }
        
        .filter-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .project-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            height: 100%;
        }
        
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .project-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .project-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .project-card:hover .project-overlay {
            opacity: 1;
        }
        
        .project-overlay .btn {
            background: white;
            color: var(--primary-color);
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
        }
        
        .project-content {
            padding: 1.5rem;
        }
        
        .project-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .project-creator {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #20c997);
            border-radius: 4px;
        }
        
        .project-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .project-target {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .project-progress {
            font-size: 0.9rem;
            color: #666;
        }
        
        .project-tags {
            margin-bottom: 1rem;
        }
        
        .tag {
            display: inline-block;
            background: #f8f9fa;
            color: #666;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .sort-controls {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .results-count {
            color: #666;
            font-size: 1.1rem;
        }
        
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }
        
        .no-results i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Search Header -->
    <section class="search-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-3">
                        {% if search_performed %}
                            Search Results
                        {% else %}
                            Discover Projects
                        {% endif %}
                    </h1>
                    <p class="lead mb-0">
                        {% if search_performed %}
                            Find the perfect projects to support
                        {% else %}
                            Explore our collection of innovative crowdfunding projects
                        {% endif %}
                    </p>
                </div>
                <div class="col-lg-4 text-end">
                    <a href="{% url 'homepage:homepage' %}" class="btn btn-outline-light">
                        <i class="fas fa-home me-2"></i>Back to Home
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Search and Results -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <!-- Filter Sidebar -->
                <div class="col-lg-3">
                    <div class="filter-sidebar">
                        <h4 class="mb-4">Advanced Filters</h4>
                        
                        <form method="GET" action="{% url 'homepage:search_results' %}">
                            <!-- Search Query -->
                            <div class="filter-section">
                                <label class="filter-title">Search Query</label>
                                <input type="text" name="search_query" class="form-control" 
                                       value="{{ search_form.search_query.value|default:'' }}"
                                       placeholder="Enter search term...">
                            </div>
                            
                            <!-- Search Type -->
                            <div class="filter-section">
                                <label class="filter-title">Search Type</label>
                                <select name="search_type" class="form-control">
                                    {% for value, label in search_form.search_type.field.choices %}
                                    <option value="{{ value }}" {% if search_form.search_type.value == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Category -->
                            <div class="filter-section">
                                <label class="filter-title">Category</label>
                                <select name="category" class="form-control">
                                    {% for choice in search_form.category.field.choices %}
                                    <option value="{{ choice.0 }}" {% if search_form.category.value == choice.0 %}selected{% endif %}>
                                        {{ choice.1 }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Target Amount Range -->
                            <div class="filter-section">
                                <label class="filter-title">Target Amount (EGP)</label>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <input type="number" name="min_target" class="form-control" 
                                               value="{{ search_form.min_target.value|default:'' }}"
                                               placeholder="Min">
                                    </div>
                                    <div class="col-6">
                                        <input type="number" name="max_target" class="form-control" 
                                               value="{{ search_form.max_target.value|default:'' }}"
                                               placeholder="Max">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status -->
                            <div class="filter-section">
                                <label class="filter-title">Project Status</label>
                                <select name="status" class="form-control">
                                    {% for choice in search_form.status.field.choices %}
                                    <option value="{{ choice.0 }}" {% if search_form.status.value == choice.0 %}selected{% endif %}>
                                        {{ choice.1 }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Apply Filters Button -->
                            <button type="submit" class="btn btn-primary w-100 mb-3">
                                <i class="fas fa-filter me-2"></i>Apply Filters
                            </button>
                            
                            <!-- Clear Filters -->
                            <a href="{% url 'homepage:search_results' %}" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-times me-2"></i>Clear Filters
                            </a>
                        </form>
                        
                        <!-- Categories List -->
                        <hr class="my-4">
                        <h6 class="filter-title">Browse Categories</h6>
                        <div class="list-group list-group-flush">
                            {% for category in categories %}
                            <a href="{% url 'projects:category_detail' category.pk %}" 
                               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                {{ category.name }}
                                <span class="badge bg-primary rounded-pill">{{ category.project_count }}</span>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Results Column -->
                <div class="col-lg-9">
                    <!-- Sort Controls -->
                    <div class="sort-controls">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <span class="results-count">
                                    {% if projects %}
                                        {% if projects|length == 1 %}
                                            1 project found
                                        {% else %}
                                            {{ projects|length }} projects found
                                        {% endif %}
                                    {% else %}
                                        No projects found
                                    {% endif %}
                                </span>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <label class="me-2">Sort by:</label>
                                <select class="form-select d-inline-block w-auto" onchange="this.form.submit()">
                                    <option value="-created_at" {% if request.GET.sort == '-created_at' %}selected{% endif %}>Newest First</option>
                                    <option value="rating" {% if request.GET.sort == 'rating' %}selected{% endif %}>Highest Rated</option>
                                    <option value="target" {% if request.GET.sort == 'target' %}selected{% endif %}>Highest Target</option>
                                    <option value="deadline" {% if request.GET.sort == 'deadline' %}selected{% endif %}>Ending Soon</option>
                                    <option value="funding" {% if request.GET.sort == 'funding' %}selected{% endif %}>Most Funded</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Search Results -->
                    {% if projects %}
                        <div class="row">
                            {% for project in projects %}
                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="project-card">
                                    <div class="project-image" style="background-image: url('{% if project.images.first %}{{ project.images.first.image.url }}{% else %}https://via.placeholder.com/400x200/667eea/ffffff?text=No+Image{% endif %}');">
                                        <div class="project-overlay">
                                            <a href="{% url 'projects:project_detail' project.slug %}" class="btn">
                                                <i class="fas fa-eye me-2"></i>View Project
                                            </a>
                                        </div>
                                        {% if project.is_featured %}
                                        <div class="position-absolute top-0 start-0 m-3">
                                            <span class="badge bg-warning text-dark">
                                                <i class="fas fa-star me-1"></i>Featured
                                            </span>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="project-content">
                                        <h5 class="project-title">{{ project.title }}</h5>
                                        <p class="project-creator">by {{ project.creator.get_full_name }}</p>
                                        
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{ project.progress_percentage }}%"></div>
                                        </div>
                                        
                                        <div class="project-stats">
                                            <span class="project-target">{{ project.current_amount|floatformat:0 }} EGP</span>
                                            <span class="project-progress">{{ project.progress_percentage|floatformat:1 }}%</span>
                                        </div>
                                        
                                        <div class="project-tags">
                                            {% for tag in project.tags.all|slice:":3" %}
                                            <span class="tag">{{ tag.name }}</span>
                                            {% endfor %}
                                        </div>
                                        
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                {{ project.created_at|timesince }} ago
                                            </small>
                                            <small class="text-muted">
                                                <i class="fas fa-calendar me-1"></i>
                                                {{ project.days_remaining }} days left
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="no-results">
                            <i class="fas fa-search"></i>
                            <h4>No projects found</h4>
                            <p class="mb-4">
                                {% if search_performed %}
                                    Try adjusting your search criteria or browse our categories to discover amazing projects.
                                {% else %}
                                    Start exploring our platform to find projects that inspire you.
                                {% endif %}
                            </p>
                            <div class="d-flex gap-3 justify-content-center">
                                <a href="{% url 'projects:project_list' %}" class="btn btn-primary">
                                    <i class="fas fa-list me-2"></i>Browse All Projects
                                </a>
                                <a href="{% url 'homepage:category_explore' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-compass me-2"></i>Explore Categories
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4">
        <div class="container text-center">
            <p class="mb-0">
                &copy; 2024 Crowdfunding Platform. All rights reserved.
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-submit form when sort selection changes
        document.querySelector('select[onchange]').addEventListener('change', function() {
            // Get current form data
            const form = document.querySelector('form');
            const formData = new FormData(form);
            
            // Add sort parameter
            formData.set('sort', this.value);
            
            // Build query string
            const params = new URLSearchParams(formData);
            
            // Redirect with new parameters
            window.location.href = '{% url "homepage:search_results" %}?' + params.toString();
        });
    </script>
</body>
</html>
