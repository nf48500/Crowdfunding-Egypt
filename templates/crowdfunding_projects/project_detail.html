<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project.title }} - Crowdfunding Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
        }
        
        .project-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 60px 0;
        }
        
        .project-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .project-meta {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .meta-item i {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .image-slider {
            background: #f8f9fa;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .main-image {
            height: 400px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 15px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .image-nav:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        
        .image-nav.prev {
            left: 20px;
        }
        
        .image-nav.next {
            right: 20px;
        }
        
        .thumbnail-container {
            display: flex;
            gap: 10px;
            padding: 20px;
            overflow-x: auto;
        }
        
        .thumbnail {
            width: 80px;
            height: 60px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .thumbnail.active {
            border-color: var(--primary-color);
        }
        
        .project-stats {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .progress-container {
            margin-bottom: 1.5rem;
        }
        
        .progress-bar {
            height: 12px;
            border-radius: 6px;
            background: #e9ecef;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #20c997);
            border-radius: 6px;
            transition: width 0.3s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .project-content {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .project-tags {
            margin-bottom: 1.5rem;
        }
        
        .tag {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 6px 15px;
            border-radius: 25px;
            font-size: 0.9rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .donation-form {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .donation-amounts {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .amount-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #666;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .amount-btn:hover,
        .amount-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .comments-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .comment {
            border-bottom: 1px solid #e9ecef;
            padding: 1.5rem 0;
        }
        
        .comment:last-child {
            border-bottom: none;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .comment-author {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .comment-date {
            color: #666;
            font-size: 0.9rem;
        }
        
        .comment-content {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        .comment-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }
        
        .action-btn:hover {
            color: var(--primary-color);
        }
        
        .reply-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }
        
        .reply-form.active {
            display: block;
        }
        
        .replies {
            margin-left: 2rem;
            margin-top: 1rem;
            padding-left: 1rem;
            border-left: 3px solid #e9ecef;
        }
        
        .rating-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .rating-stars {
            font-size: 2rem;
            color: var(--warning-color);
            margin-bottom: 1rem;
        }
        
        .rating-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        .similar-projects {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .similar-project-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            transition: all 0.3s ease;
        }
        
        .similar-project-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .report-modal .modal-header {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-cancel-project {
            background: var(--danger-color);
            border: none;
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-cancel-project:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .project-title {
                font-size: 2rem;
            }
            
            .project-meta {
                flex-direction: column;
                gap: 1rem;
            }
            
            .main-image {
                height: 300px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Project Header -->
    <section class="project-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="project-title">{{ project.title }}</h1>
                    <div class="project-meta">
                        <div class="meta-item">
                            <i class="fas fa-user"></i>
                            <span>by {{ project.creator.get_full_name }}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-folder"></i>
                            <span>{{ project.category.name }}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-calendar"></i>
                            <span>{{ project.created_at|date:"M d, Y" }}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span>{{ project.days_remaining }} days left</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 text-end">
                    <a href="{% url 'projects:project_list' %}" class="btn btn-outline-light">
                        <i class="fas fa-arrow-left me-2"></i>Back to Projects
                    </a>
                </div>
            </div>
        </div>
    </section>

    <div class="container py-5">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Image Slider -->
                {% if project.images.all %}
                <div class="image-slider">
                    <div class="main-image" id="mainImage" style="background-image: url('{{ project.images.first.image.url }}');">
                        {% if project.images.count > 1 %}
                        <button class="image-nav prev" onclick="changeImage(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="image-nav next" onclick="changeImage(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        {% endif %}
                    </div>
                    {% if project.images.count > 1 %}
                    <div class="thumbnail-container">
                        {% for image in project.images.all %}
                        <div class="thumbnail {% if forloop.first %}active{% endif %}" 
                             onclick="showImage({{ forloop.counter0 }})"
                             style="background-image: url('{{ image.image.url }}');">
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Project Stats -->
                <div class="project-stats">
                    <div class="progress-container">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="mb-0">Funding Progress</h5>
                            <span class="fw-bold">{{ project.progress_percentage|floatformat:1 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ project.progress_percentage }}%"></div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">Raised: {{ project.current_amount|floatformat:0 }} EGP</span>
                            <span class="text-muted">Goal: {{ project.total_target|floatformat:0 }} EGP</span>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">{{ project.days_remaining }}</div>
                            <div class="stat-label">Days Left</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ project.donations.count }}</div>
                            <div class="stat-label">Backers</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ project.average_rating|floatformat:1 }}</div>
                            <div class="stat-label">Rating ({{ project.total_ratings }})</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ project.comments.count }}</div>
                            <div class="stat-label">Comments</div>
                        </div>
                    </div>
                </div>

                <!-- Project Content -->
                <div class="project-content">
                    <h3 class="section-title">About This Project</h3>
                    <div class="project-tags">
                        {% for tag in project.tags.all %}
                        <span class="tag">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                    <div class="project-description">
                        {{ project.details|linebreaks }}
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="comments-section">
                    <h3 class="section-title">Comments & Discussion</h3>
                    
                    {% if user.is_authenticated %}
                    <form method="POST" action="{% url 'projects:add_comment' project.slug %}" class="mb-4">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="comment-content" class="form-label">Add a comment</label>
                            {{ comment_form.content }}
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-comment me-2"></i>Post Comment
                        </button>
                    </form>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Please <a href="{% url 'accounts:login' %}">login</a> to add comments.
                    </div>
                    {% endif %}

                    <!-- Comments List -->
                    {% if comments %}
                        {% for comment in comments %}
                        <div class="comment" id="comment-{{ comment.id }}">
                            <div class="comment-header">
                                <span class="comment-author">{{ comment.user.get_full_name }}</span>
                                <span class="comment-date">{{ comment.created_at|timesince }} ago</span>
                            </div>
                            <div class="comment-content">
                                {{ comment.content|linebreaks }}
                            </div>
                            <div class="comment-actions">
                                {% if user.is_authenticated %}
                                <button class="action-btn" onclick="toggleReplyForm({{ comment.id }})">
                                    <i class="fas fa-reply me-1"></i>Reply
                                </button>
                                <button class="action-btn" onclick="showReportModal('comment', {{ comment.id }})">
                                    <i class="fas fa-flag me-1"></i>Report
                                </button>
                                {% endif %}
                            </div>
                            
                            <!-- Reply Form -->
                            <div class="reply-form" id="reply-form-{{ comment.id }}">
                                <form method="POST" action="{% url 'projects:add_reply' comment.id %}">
                                    {% csrf_token %}
                                    <div class="mb-3">
                                        <label for="reply-content-{{ comment.id }}" class="form-label">Write a reply</label>
                                        <textarea name="content" id="reply-content-{{ comment.id }}" 
                                                  class="form-control" rows="2" 
                                                  placeholder="Write your reply..." maxlength="500"></textarea>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary btn-sm">Post Reply</button>
                                        <button type="button" class="btn btn-secondary btn-sm" 
                                                onclick="toggleReplyForm({{ comment.id }})">Cancel</button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Replies -->
                            {% if comment.replies.all %}
                            <div class="replies">
                                {% for reply in comment.replies.all %}
                                {% if reply.is_approved %}
                                <div class="comment">
                                    <div class="comment-header">
                                        <span class="comment-author">{{ reply.user.get_full_name }}</span>
                                        <span class="comment-date">{{ reply.created_at|timesince }} ago</span>
                                    </div>
                                    <div class="comment-content">
                                        {{ reply.content|linebreaks }}
                                    </div>
                                    {% if user.is_authenticated %}
                                    <div class="comment-actions">
                                        <button class="action-btn" onclick="showReportModal('comment', {{ reply.id }})">
                                            <i class="fas fa-flag me-1"></i>Report
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted text-center py-4">
                            <i class="fas fa-comments fa-2x mb-3 d-block"></i>
                            No comments yet. Be the first to start the discussion!
                        </p>
                    {% endif %}
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Donation Form -->
                <div class="donation-form">
                    <h4 class="section-title">Support This Project</h4>
                    
                    {% if project.status == 'active' %}
                        {% if user.is_authenticated %}
                        <form method="POST" action="{% url 'projects:add_donation' project.slug %}">
                            {% csrf_token %}
                            
                            <div class="donation-amounts">
                                <button type="button" class="amount-btn" onclick="setAmount(50)">50 EGP</button>
                                <button type="button" class="amount-btn" onclick="setAmount(100)">100 EGP</button>
                                <button type="button" class="amount-btn" onclick="setAmount(250)">250 EGP</button>
                                <button type="button" class="amount-btn" onclick="setAmount(500)">500 EGP</button>
                            </div>
                            
                            <div class="mb-3">
                                <label for="donation-amount" class="form-label">Amount (EGP)</label>
                                {{ donation_form.amount }}
                            </div>
                            
                            <div class="mb-3">
                                <label for="donation-message" class="form-label">Message (Optional)</label>
                                {{ donation_form.message }}
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    {{ donation_form.is_anonymous }}
                                    <label class="form-check-label" for="{{ donation_form.is_anonymous.id_for_label }}">
                                        Make donation anonymous
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-heart me-2"></i>Support Project
                            </button>
                        </form>
                        {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Please <a href="{% url 'accounts:login' %}">login</a> to support this project.
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            This project is no longer accepting donations.
                        </div>
                    {% endif %}
                </div>

                <!-- Rating Section -->
                <div class="rating-section">
                    <h4 class="section-title">Rate This Project</h4>
                    
                    <div class="text-center mb-3">
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= project.average_rating %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <p class="mb-0">{{ project.average_rating|floatformat:1 }} out of 5 stars</p>
                        <small class="text-muted">({{ project.total_ratings }} ratings)</small>
                    </div>
                    
                    {% if user.is_authenticated %}
                        {% if user_rating %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                You rated this project {{ user_rating.rating }} stars.
                            </div>
                        {% endif %}
                        
                        <form method="POST" action="{% url 'projects:add_rating' project.slug %}">
                            {% csrf_token %}
                            <div class="rating-form">
                                <div class="mb-3">
                                    <label for="rating" class="form-label">Your Rating</label>
                                    {{ rating_form.rating }}
                                </div>
                                <div class="mb-3">
                                    <label for="review" class="form-label">Review (Optional)</label>
                                    {{ rating_form.review }}
                                </div>
                                <button type="submit" class="btn btn-warning w-100">
                                    <i class="fas fa-star me-2"></i>
                                    {% if user_rating %}Update Rating{% else %}Rate Project{% endif %}
                                </button>
                            </div>
                        </form>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Please <a href="{% url 'accounts:login' %}">login</a> to rate this project.
                        </div>
                    {% endif %}
                </div>

                <!-- Project Actions -->
                {% if user == project.creator %}
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Project Management</h5>
                        <div class="d-grid gap-2">
                            <a href="{% url 'projects:project_edit' project.slug %}" class="btn btn-outline-primary">
                                <i class="fas fa-edit me-2"></i>Edit Project
                            </a>
                            {% if project.is_cancellable %}
                            <button type="button" class="btn-cancel-project" 
                                    onclick="showCancelModal()">
                                <i class="fas fa-times me-2"></i>Cancel Project
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Report Project -->
                {% if user.is_authenticated %}
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Report Project</h5>
                        <p class="card-text text-muted">
                            Found something inappropriate? Help us keep our community safe.
                        </p>
                        <button type="button" class="btn btn-outline-danger w-100" 
                                onclick="showReportModal('project', null)">
                            <i class="fas fa-flag me-2"></i>Report Project
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Similar Projects -->
        {% if similar_projects %}
        <div class="row mt-5">
            <div class="col-12">
                <div class="similar-projects">
                    <h3 class="section-title">Similar Projects You Might Like</h3>
                    <div class="row">
                        {% for similar_project in similar_projects %}
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="similar-project-card">
                                <h6 class="fw-bold">{{ similar_project.title }}</h6>
                                <p class="text-muted small mb-2">by {{ similar_project.creator.get_full_name }}</p>
                                <div class="progress mb-2" style="height: 6px;">
                                    <div class="progress-bar" style="width: {{ similar_project.progress_percentage }}%"></div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">{{ similar_project.progress_percentage|floatformat:1 }}%</small>
                                    <small class="text-muted">{{ similar_project.days_remaining }} days left</small>
                                </div>
                                <a href="{% url 'projects:project_detail' similar_project.slug %}" 
                                   class="btn btn-sm btn-outline-primary w-100">
                                    View Project
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Report Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Report Inappropriate Content</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" id="reportForm">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="report-reason" class="form-label">Reason for Report</label>
                            {{ report_form.reason }}
                        </div>
                        <div class="mb-3">
                            <label for="report-description" class="form-label">Additional Details</label>
                            {{ report_form.description }}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Submit Report</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cancel Project Modal -->
    <div class="modal fade" id="cancelModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">Cancel Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Are you sure you want to cancel this project?</strong></p>
                    <p>This action cannot be undone. The project will be marked as cancelled and will no longer accept donations.</p>
                    <p><strong>Current funding:</strong> {{ project.progress_percentage|floatformat:1 }}% ({{ project.current_amount|floatformat:0 }} EGP)</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Keep Project</button>
                    <form method="POST" action="{% url 'projects:project_cancel' project.slug %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-warning">Cancel Project</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Image slider functionality
        let currentImageIndex = 0;
        const images = [
            {% for image in project.images.all %}
                '{{ image.image.url }}',
            {% endfor %}
        ];
        
        function changeImage(direction) {
            currentImageIndex = (currentImageIndex + direction + images.length) % images.length;
            updateImage();
        }
        
        function showImage(index) {
            currentImageIndex = index;
            updateImage();
        }
        
        function updateImage() {
            document.getElementById('mainImage').style.backgroundImage = `url('${images[currentImageIndex]}')`;
            
            // Update thumbnail active state
            document.querySelectorAll('.thumbnail').forEach((thumb, index) => {
                thumb.classList.toggle('active', index === currentImageIndex);
            });
        }
        
        // Reply form functionality
        function toggleReplyForm(commentId) {
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            replyForm.classList.toggle('active');
        }
        
        // Donation amount buttons
        function setAmount(amount) {
            document.getElementById('{{ donation_form.amount.id_for_label }}').value = amount;
            
            // Update active state
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(amount.toString())) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Report modal functionality
        function showReportModal(type, id) {
            const modal = new bootstrap.Modal(document.getElementById('reportModal'));
            const form = document.getElementById('reportForm');
            
            if (type === 'comment') {
                form.action = `{% url 'projects:report_comment' 0 %}`.replace('0', id);
            } else {
                form.action = `{% url 'projects:report_project' project.slug %}`;
            }
            
            modal.show();
        }
        
        // Cancel project modal
        function showCancelModal() {
            const modal = new bootstrap.Modal(document.getElementById('cancelModal'));
            modal.show();
        }
    </script>
</body>
</html>
